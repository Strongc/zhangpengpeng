<html lang="en">
<head>
<title>TCP Sockets - MIT/GNU Scheme 9.0.1</title>
<meta http-equiv="Content-Type" content="text/html">
<meta name="description" content="MIT/GNU Scheme 9.0.1">
<meta name="generator" content="makeinfo 4.13">
<link title="Top" rel="start" href="index.html#Top">
<link rel="up" href="Operating_002dSystem-Interface.html#Operating_002dSystem-Interface" title="Operating-System Interface">
<link rel="prev" href="Subprocesses.html#Subprocesses" title="Subprocesses">
<link rel="next" href="Miscellaneous-OS-Facilities.html#Miscellaneous-OS-Facilities" title="Miscellaneous OS Facilities">
<link href="http://www.gnu.org/software/texinfo/" rel="generator-home" title="Texinfo Homepage">
<!--
This manual documents MIT/GNU Scheme 9.0.1.

Copyright (C) 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993,
    1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004,
    2005, 2006, 2007, 2008, 2009, 2010 Massachusetts Institute of
    Technology

     Permission is granted to copy, distribute and/or modify this
     document under the terms of the GNU Free Documentation License,
     Version 1.2 or any later version published by the Free Software
     Foundation; with no Invariant Sections, with the Front-Cover Texts
     being ``A GNU Manual,'' and with the Back-Cover Texts as in (a)
     below.  A copy of the license is included in the section entitled
     ``GNU Free Documentation License.''

     (a) The FSF's Back-Cover Text is: ``You have freedom to copy and
     modify this GNU Manual, like GNU software.  Copies published by
     the Free Software Foundation raise funds for GNU development.''
   -->
<meta http-equiv="Content-Style-Type" content="text/css">
<style type="text/css"><!--
  pre.display { font-family:inherit }
  pre.format  { font-family:inherit }
  pre.smalldisplay { font-family:inherit; font-size:smaller }
  pre.smallformat  { font-family:inherit; font-size:smaller }
  pre.smallexample { font-size:smaller }
  pre.smalllisp    { font-size:smaller }
  span.sc    { font-variant:small-caps }
  span.roman { font-family:serif; font-weight:normal; } 
  span.sansserif { font-family:sans-serif; font-weight:normal; } 
--></style>
</head>
<body>
<div class="node">
<a name="TCP-Sockets"></a>
<p>
Next:&nbsp;<a rel="next" accesskey="n" href="Miscellaneous-OS-Facilities.html#Miscellaneous-OS-Facilities">Miscellaneous OS Facilities</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="Subprocesses.html#Subprocesses">Subprocesses</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="Operating_002dSystem-Interface.html#Operating_002dSystem-Interface">Operating-System Interface</a>
<hr>
</div>

<h3 class="section">15.8 TCP Sockets</h3>

<p><a name="index-socket-2735"></a>MIT/GNU Scheme provides access to <dfn>sockets</dfn>, which are a mechanism for
inter-process communication.  <span class="sc">tcp</span> stream sockets are supported,
which communicate between computers over a <span class="sc">tcp/ip</span> network. 
<span class="sc">tcp</span> sockets are supported on all operating systems.

   <p><a name="index-client-socket-2736"></a><a name="index-server-socket-2737"></a><span class="sc">tcp</span> sockets have two distinct interfaces: one interface to
implement a <dfn>client</dfn> and another to implement a <dfn>server</dfn>.  The
basic protocol is that servers set up a listening port and wait for
connections from clients.  Implementation of clients is simpler and will
be treated first.

   <p><a name="index-hostname_002c-TCP-2738"></a>The socket procedures accept two special arguments, called
<var>host-name</var> and <var>service</var>.  <var>Host-name</var> is a string which
must be the name of an internet host.  It is looked up using the
ordinary lookup rules for your computer.  For example, if your host is
<code>foo.mit.edu</code> and <var>host-name</var> is <code>"bar"</code>, then it
specifies <code>bar.mit.edu</code>.

   <p><a name="index-service_002c-TCP-2739"></a><a name="index-port-number_002c-TCP-2740"></a><var>Service</var> specifies the service to which you will connect.  A
networked computer normally provides several different services, such as
telnet or <acronym>FTP</acronym>.  Each service is associated with a unique
<dfn>port number</dfn>; for example, the <code>"www"</code> service is associated
with port <code>80</code>.  The <var>service</var> argument specifies the port
number, either as a string, or directly as an exact non-negative
integer.  Port strings are decoded by the operating system using a
table; for example, on unix the table is in <samp><span class="file">/etc/services</span></samp>. 
Usually you will use a port string rather than a number.

<div class="defun">
&mdash; procedure: <b>open-tcp-stream-socket</b><var> host-name service </var>[<var>buffer-size </var>[<var>line-translation</var>]]<var><a name="index-open_002dtcp_002dstream_002dsocket-2741"></a></var><br>
<blockquote><p><code>open-tcp-stream-socket</code> opens a connection to the host specified
by <var>host-name</var>.  <var>Host-name</var> is looked up using the ordinary
lookup rules for your computer.  The connection is established to the
service specified by <var>service</var>.  The returned value is an
<acronym>I/O</acronym> port, to which you can read and write characters using
ordinary Scheme <acronym>I/O</acronym> procedures such as <code>read-char</code> and
<code>write-char</code>.

        <p><var>Buffer-size</var> specifies the size of the read and write buffers used
by the port; if this is unspecified or <code>#f</code>, the buffers will hold
<code>4096</code> bytes.

        <p><var>Line-translation</var> specifies how end-of-line characters will be
translated when reading or writing to the socket.  If this is
unspecified or <code>#f</code>, then lines will be terminated by <span class="sc">cr-lf</span>,
which is the standard for most internet protocols.  Otherwise, it must
be a string, which specifies the line-ending character sequence to use.

        <p>When you wish to close the connection, just use <code>close-port</code>.

        <p>As an example, here is how you can open a connection to a web server:

     <pre class="example">          (open-tcp-stream-socket "web.mit.edu" "www")
</pre>
        </blockquote></div>

   <p><a name="index-server-socket-2742"></a>Next we will treat setting up a <span class="sc">tcp</span> server, which is slightly more
complicated.  Creating a server is a two-part process.  First, you must
open a <dfn>server socket</dfn>, which causes the operating system to listen
to the network on a port that you specify.  Once the server socket is
opened, the operating system will allow clients to connect to your
computer on that port.

   <p>In the second step of the process, you <dfn>accept</dfn> the connection,
which completes the connection initiated by the client, and allows you
to communicate with the client.  Accepting a connection does not affect
the server socket; it continues to listen for additional client
connections.  You can have multiple client connections to the same
server socket open simultaneously.

<div class="defun">
&mdash; procedure: <b>open-tcp-server-socket</b><var> service </var>[<var>address</var>]<var><a name="index-open_002dtcp_002dserver_002dsocket-2743"></a></var><br>
<blockquote><p>This procedure opens a server socket that listens for connections to
<var>service</var>; the socket will continue to listen until you close it. 
The returned value is a server socket object.

        <p>An error is signalled if another process is already listening on the
service.  Additionally, ports whose number is less than <code>1024</code> are
privileged on many operating systems, and cannot be used by
non-privileged processes; if <var>service</var> specifies such a port and you
do not have administrative privileges, an error may be signalled.

        <p>The optional argument <var>address</var> specifies the <acronym>IP</acronym> address
on which the socket will listen.  If this argument is not supplied or is
given as <code>#f</code>, then the socket listens on all <acronym>IP</acronym>
addresses for this machine.  (This is equivalent to passing the result
of calling <code>host-address-any</code>.) 
</p></blockquote></div>

<div class="defun">
&mdash; procedure: <b>tcp-server-connection-accept</b><var> server-socket block? peer-address </var>[<var>line-translation</var>]<var><a name="index-tcp_002dserver_002dconnection_002daccept-2744"></a></var><br>
<blockquote><p>Checks to see if a client has connected to <var>server-socket</var>.  If
so, an <acronym>I/O</acronym> port is returned.  The returned port can be read
and written using ordinary Scheme <acronym>I/O</acronym> procedures such as
<code>read-char</code> and <code>write-char</code>.

        <p>The argument <var>block?</var> says what to do if no client has connected at
the time of the call.  If <code>#f</code>, it says to return immediately with
two values of <code>#f</code>.  Otherwise, the call waits until a client
connects.

        <p>The argument <var>peer-address</var> is either <code>#f</code> or an <acronym>IP</acronym>
address as allocated by <code>allocate-host-address</code>.  If it is an
<acronym>IP</acronym> address, the address is modified to be the address of the
client making the connection.

        <p>The optional argument <var>line-translation</var> specifies how end-of-line
characters will be translated when reading or writing to the returned
socket.  If this is unspecified or <code>#f</code>, then lines will be
terminated by <span class="sc">cr-lf</span>, which is the standard for most internet
protocols.  Otherwise, it must be a string, which specifies the
line-ending character sequence to use.

        <p>Note that closing the port returned by this procedure does not affect
<var>server-socket</var>; it just closes the particular client connection
that was opened by the call.  To close <var>server-socket</var>, use
<code>close-tcp-server-socket</code>. 
</p></blockquote></div>

<div class="defun">
&mdash; procedure: <b>close-tcp-server-socket</b><var> server-socket<a name="index-close_002dtcp_002dserver_002dsocket-2745"></a></var><br>
<blockquote><p>Closes the server socket <var>server-socket</var>.  The operating system will
cease listening for network connections to that service.  Client
connections to <var>server-socket</var> that have already been accepted will
not be affected. 
</p></blockquote></div>

   </body></html>

