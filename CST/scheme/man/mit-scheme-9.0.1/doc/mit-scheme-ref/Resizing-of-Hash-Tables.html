<html lang="en">
<head>
<title>Resizing of Hash Tables - MIT/GNU Scheme 9.0.1</title>
<meta http-equiv="Content-Type" content="text/html">
<meta name="description" content="MIT/GNU Scheme 9.0.1">
<meta name="generator" content="makeinfo 4.13">
<link title="Top" rel="start" href="index.html#Top">
<link rel="up" href="Hash-Tables.html#Hash-Tables" title="Hash Tables">
<link rel="prev" href="Basic-Hash-Table-Operations.html#Basic-Hash-Table-Operations" title="Basic Hash Table Operations">
<link rel="next" href="Address-Hashing.html#Address-Hashing" title="Address Hashing">
<link href="http://www.gnu.org/software/texinfo/" rel="generator-home" title="Texinfo Homepage">
<!--
This manual documents MIT/GNU Scheme 9.0.1.

Copyright (C) 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993,
    1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004,
    2005, 2006, 2007, 2008, 2009, 2010 Massachusetts Institute of
    Technology

     Permission is granted to copy, distribute and/or modify this
     document under the terms of the GNU Free Documentation License,
     Version 1.2 or any later version published by the Free Software
     Foundation; with no Invariant Sections, with the Front-Cover Texts
     being ``A GNU Manual,'' and with the Back-Cover Texts as in (a)
     below.  A copy of the license is included in the section entitled
     ``GNU Free Documentation License.''

     (a) The FSF's Back-Cover Text is: ``You have freedom to copy and
     modify this GNU Manual, like GNU software.  Copies published by
     the Free Software Foundation raise funds for GNU development.''
   -->
<meta http-equiv="Content-Style-Type" content="text/css">
<style type="text/css"><!--
  pre.display { font-family:inherit }
  pre.format  { font-family:inherit }
  pre.smalldisplay { font-family:inherit; font-size:smaller }
  pre.smallformat  { font-family:inherit; font-size:smaller }
  pre.smallexample { font-size:smaller }
  pre.smalllisp    { font-size:smaller }
  span.sc    { font-variant:small-caps }
  span.roman { font-family:serif; font-weight:normal; } 
  span.sansserif { font-family:sans-serif; font-weight:normal; } 
--></style>
</head>
<body>
<div class="node">
<a name="Resizing-of-Hash-Tables"></a>
<p>
Next:&nbsp;<a rel="next" accesskey="n" href="Address-Hashing.html#Address-Hashing">Address Hashing</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="Basic-Hash-Table-Operations.html#Basic-Hash-Table-Operations">Basic Hash Table Operations</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="Hash-Tables.html#Hash-Tables">Hash Tables</a>
<hr>
</div>

<h4 class="subsection">11.4.3 Resizing of Hash Tables</h4>

<p><a name="index-resizing_002c-of-hash-table-1684"></a><a name="index-size_002c-of-hash-table-_0028defn_0029-1685"></a>Normally, hash tables automatically resize themselves according to need. 
Because of this, the programmer need not be concerned with management of
the table's size.  However, some limited control over the table's size
is provided, which will be discussed below.  This discussion involves
two concepts, <dfn>usable size</dfn> and <dfn>physical size</dfn>, which we will
now define.

   <p><a name="index-usable-size_002c-of-hash-table-_0028defn_0029-1686"></a>The <dfn>usable size</dfn> of a hash table is the number of associations that
the table can hold at a given time.  If the number of associations in
the table exceeds the usable size, the table will automatically grow,
increasing the usable size to a new value that is sufficient to hold the
associations.

   <p><a name="index-physical-size_002c-of-hash-table-_0028defn_0029-1687"></a>The <dfn>physical size</dfn> is an abstract measure of a hash table that
specifies how much space is allocated to hold the associations of the
table.  The physical size is always greater than or equal to the usable
size.  The physical size is not interesting in itself; it is interesting
only for its effect on the performance of the hash table.  While the
average performance of a hash-table lookup is bounded by a constant, the
worst-case performance is not.  For a table containing a given number of
associations, increasing the physical size of the table decreases the
probability that worse-than-average performance will occur.

   <p>The physical size of a hash table is statistically related to the number
of associations.  However, it is possible to place bounds on the
physical size, and from this to estimate the amount of space used by the
table:

<pre class="example">     (define (hash-table-space-bounds count rehash-size rehash-threshold)
       (let ((tf (/ 1 rehash-threshold)))
         (values (if (exact-integer? rehash-size)
                     (- (* count (+ 4 tf))
                        (* tf (+ rehash-size rehash-size)))
                     (* count (+ 4 (/ tf (* rehash-size rehash-size)))))
                 (* count (+ 4 tf)))))
</pre>
   <p class="noindent">What this formula shows is that, for a &ldquo;normal&rdquo; rehash size (that is,
not an exact integer), the amount of space used by the hash table is
proportional to the number of associations in the table.  The constant
of proportionality varies statistically, with the low bound being

<pre class="example">     (+ 4 (/ (/ 1 rehash-threshold) (* rehash-size rehash-size)))
</pre>
   <p class="noindent">and the high bound being

<pre class="example">     (+ 4 (/ 1 rehash-threshold))
</pre>
   <p class="noindent">which, for the default values of these parameters, are <code>4.25</code> and
<code>5</code>, respectively.  Reducing the rehash size will tighten these
bounds, but increases the amount of time spent resizing, so you can see
that the rehash size gives some control over the time-space tradeoff of
the table.

   <p>The programmer can control the size of a hash table by means of three
parameters:

     <ul>
<li>Each table's <var>initial-size</var> may be specified when the table is
created.

     <li>Each table has a <dfn>rehash size</dfn> that specifies how the size of the
table is changed when it is necessary to grow or shrink the table.

     <li>Each table has a <dfn>rehash threshold</dfn> that specifies the relationship
of the table's physical size to its usable size. 
</ul>

   <p><a name="index-initial-size_002c-of-hash-table-1688"></a>If the programmer knows that the table will initially contain a specific
number of items, <var>initial-size</var> can be given when the table is
created.  If <var>initial-size</var> is an exact non-negative integer, it
specifies the initial usable size of the hash table; the table will not
change size until the number of items in the table exceeds
<var>initial-size</var>, after which automatic resizing is enabled and
<var>initial-size</var> no longer has any effect.  Otherwise, if
<var>initial-size</var> is not given or is <code>#f</code>, the table is
initialized to an unspecified size and automatic resizing is immediately
enabled.

   <p><a name="index-rehash-size_002c-of-hash-table-_0028defn_0029-1689"></a>The <dfn>rehash size</dfn> specifies how much to increase the usable size of
the hash table when it becomes full.  It is either an exact positive
integer, or a real number greater than one.  If it is an integer, the
new size is the sum of the old size and the rehash size.  Otherwise, it
is a real number, and the new size is the product of the old size and
the rehash size.  Increasing the rehash size decreases the average cost
of an insertion, but increases the average amount of space used by the
table.  The rehash size of a table may be altered dynamically by the
application in order to optimize the resizing of the table; for example,
if the table will grow quickly for a known period and afterwards will
not change size, performance might be improved by using a large rehash
size during the growth phase and a small one during the static phase. 
The default rehash size of a newly constructed hash table is <code>2.0</code>.

   <p><strong>Warning</strong>: The use of an exact positive integer for a rehash
size is almost always undesirable; this option is provided solely for
compatibility with the Common Lisp hash-table mechanism.  The reason for
this has to do with the time penalty for resizing the hash table.  The
time needed to resize a hash table is proportional to the
number of associations in the table.  This resizing cost is
<dfn>amortized</dfn> across the insertions required to fill the table to the
point where it needs to grow again.  If the table grows by an amount
proportional to the number of associations, then the cost of
resizing and the increase in size are both proportional to the
number of associations, so the <dfn>amortized cost</dfn> of an insertion
operation is still bounded by a constant.  However, if the table grows
by a constant amount, this is not true: the amortized cost of an
insertion is not bounded by a constant.  Thus, using a constant rehash
size means that the average cost of an insertion increases
proportionally to the number of associations in the hash table.

   <p><a name="index-rehash-threshold_002c-of-hash-table-_0028defn_0029-1690"></a>The <dfn>rehash threshold</dfn> is a real number, between zero exclusive and
one inclusive, that specifies the ratio between a hash table's usable
size and its physical size.  Decreasing the rehash threshold decreases
the probability of worse-than-average insertion, deletion, and lookup
times, but increases the physical size of the table for a given usable
size.  The default rehash threshold of a newly constructed hash table is
<code>1</code>.

<div class="defun">
&mdash; procedure: <b>hash-table/size</b><var> hash-table<a name="index-hash_002dtable_002fsize-1691"></a></var><br>
<blockquote><p>Returns the usable size of <var>hash-table</var> as an exact positive
integer.  This is the number of associations that <var>hash-table</var> can
hold before it will grow. 
</p></blockquote></div>

<div class="defun">
&mdash; procedure: <b>hash-table/rehash-size</b><var> hash-table<a name="index-hash_002dtable_002frehash_002dsize-1692"></a></var><br>
<blockquote><p>Returns the rehash size of <var>hash-table</var>. 
</p></blockquote></div>

<div class="defun">
&mdash; procedure: <b>set-hash-table/rehash-size!</b><var> hash-table x<a name="index-set_002dhash_002dtable_002frehash_002dsize_0021-1693"></a></var><br>
<blockquote><p><var>X</var> must be either an exact positive integer, or a real number that
is greater than one.  Sets the rehash size of <var>hash-table</var> to
<var>x</var> and returns an unspecified result.  This operation adjusts the
&ldquo;shrink threshold&rdquo; of the table; the table might shrink if the number
of associations is less than the new threshold. 
</p></blockquote></div>

<div class="defun">
&mdash; procedure: <b>hash-table/rehash-threshold</b><var> hash-table<a name="index-hash_002dtable_002frehash_002dthreshold-1694"></a></var><br>
<blockquote><p>Returns the rehash threshold of <var>hash-table</var>. 
</p></blockquote></div>

<div class="defun">
&mdash; procedure: <b>set-hash-table/rehash-threshold!</b><var> hash-table x<a name="index-set_002dhash_002dtable_002frehash_002dthreshold_0021-1695"></a></var><br>
<blockquote><p><var>X</var> must be a real number between zero exclusive and one inclusive. 
Sets the rehash threshold of <var>hash-table</var> to <var>x</var> and returns an
unspecified result.  This operation does not change the usable size of
the table, but it usually changes the physical size of the table, which
causes the table to be rehashed. 
</p></blockquote></div>

   </body></html>

