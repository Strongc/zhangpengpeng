<html lang="en">
<head>
<title>Dynamic Binding - MIT/GNU Scheme 9.0.1</title>
<meta http-equiv="Content-Type" content="text/html">
<meta name="description" content="MIT/GNU Scheme 9.0.1">
<meta name="generator" content="makeinfo 4.13">
<link title="Top" rel="start" href="index.html#Top">
<link rel="up" href="Special-Forms.html#Special-Forms" title="Special Forms">
<link rel="prev" href="Lexical-Binding.html#Lexical-Binding" title="Lexical Binding">
<link rel="next" href="Definitions.html#Definitions" title="Definitions">
<link href="http://www.gnu.org/software/texinfo/" rel="generator-home" title="Texinfo Homepage">
<!--
This manual documents MIT/GNU Scheme 9.0.1.

Copyright (C) 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993,
    1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004,
    2005, 2006, 2007, 2008, 2009, 2010 Massachusetts Institute of
    Technology

     Permission is granted to copy, distribute and/or modify this
     document under the terms of the GNU Free Documentation License,
     Version 1.2 or any later version published by the Free Software
     Foundation; with no Invariant Sections, with the Front-Cover Texts
     being ``A GNU Manual,'' and with the Back-Cover Texts as in (a)
     below.  A copy of the license is included in the section entitled
     ``GNU Free Documentation License.''

     (a) The FSF's Back-Cover Text is: ``You have freedom to copy and
     modify this GNU Manual, like GNU software.  Copies published by
     the Free Software Foundation raise funds for GNU development.''
   -->
<meta http-equiv="Content-Style-Type" content="text/css">
<style type="text/css"><!--
  pre.display { font-family:inherit }
  pre.format  { font-family:inherit }
  pre.smalldisplay { font-family:inherit; font-size:smaller }
  pre.smallformat  { font-family:inherit; font-size:smaller }
  pre.smallexample { font-size:smaller }
  pre.smalllisp    { font-size:smaller }
  span.sc    { font-variant:small-caps }
  span.roman { font-family:serif; font-weight:normal; } 
  span.sansserif { font-family:sans-serif; font-weight:normal; } 
--></style>
</head>
<body>
<div class="node">
<a name="Dynamic-Binding"></a>
<p>
Next:&nbsp;<a rel="next" accesskey="n" href="Definitions.html#Definitions">Definitions</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="Lexical-Binding.html#Lexical-Binding">Lexical Binding</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="Special-Forms.html#Special-Forms">Special Forms</a>
<hr>
</div>

<h3 class="section">2.3 Dynamic Binding</h3>

<div class="defun">
&mdash; special form: <b>fluid-let</b> ((<var>variable init</var>)<var> <small class="dots">...</small></var>)<var> expression expression <small class="dots">...</small><a name="index-fluid_002dlet-223"></a></var><br>
<blockquote><p><a name="index-binding-expression_002c-dynamic-_0028or-fluid_0029-224"></a><a name="index-fluid-binding-225"></a><a name="index-dynamic-binding-226"></a><a name="index-variable-binding_002c-fluid_002dlet-227"></a>The <var>init</var>s are evaluated in the current environment (in some
unspecified order), the current values of the <var>variable</var>s are saved,
the results are assigned to the <var>variable</var>s, the <var>expression</var>s
are evaluated sequentially in the current environment, the
<var>variable</var>s are restored to their original values, and the value of
the last <var>expression</var> is returned.

        <p><a name="index-let-228"></a>The syntax of this special form is similar to that of <code>let</code>, but
<code>fluid-let</code> temporarily rebinds existing variables.  Unlike
<code>let</code>, <code>fluid-let</code> creates no new bindings; instead it
<em>assigns</em> the value of each <var>init</var> to the binding (determined
by the rules of lexical scoping) of its corresponding <var>variable</var>.

        <p><a name="index-unassigned-variable_002c-and-dynamic-bindings-229"></a>MIT/GNU Scheme allows any of the <var>init</var>s to be omitted, in which
case the corresponding <var>variable</var>s are temporarily unassigned.

        <p>An error of type <code>condition-type:unbound-variable</code> is signalled if
any of the <var>variable</var>s are unbound.  However, because
<code>fluid-let</code> operates by means of side effects, it is valid for any
<var>variable</var> to be unassigned when the form is entered. 
<a name="index-condition_002dtype_003aunbound_002dvariable-230"></a>
Here is an example showing the difference between <code>fluid-let</code> and
<code>let</code>.  First see how <code>let</code> affects the binding of a variable:

     <pre class="example">          (define variable #t)
          (define (access-variable) variable)
          variable                                &rArr;  #t
          (let ((variable #f))
            (access-variable))                    &rArr;  #t
          variable                                &rArr;  #t
</pre>
        <p><code>access-variable</code> returns <code>#t</code> in this case because it
is defined in an environment with <code>variable</code> bound to
<code>#t</code>.  <code>fluid-let</code>, on the other hand, temporarily reuses an
existing variable:

     <pre class="example">          variable                                &rArr;  #t
          (fluid-let ((variable #f))              <span class="roman">;reuses old binding</span>
            (access-variable))                    &rArr;  #f
          variable                                &rArr;  #t
</pre>
        <p><a name="index-extent_002c-of-dynamic-binding-_0028defn_0029-231"></a>The <dfn>extent</dfn> of a dynamic binding is defined to be the time period
during which the variable contains the new value.  Normally this time
period begins when the body is entered and ends when it is exited; on a
sequential machine it is normally a contiguous time period.  However,
because Scheme has first-class continuations, it is possible to leave
the body and then reenter it, as many times as desired.  In this
situation, the extent becomes non-contiguous.

        <p><a name="index-dynamic-binding_002c-and-continuations-232"></a><a name="index-continuation_002c-and-dynamic-binding-233"></a>When the body is exited by invoking a continuation, the new value is
saved, and the variable is set to the old value.  Then, if the body is
reentered by invoking a continuation, the old value is saved, and the
variable is set to the new value.  In addition, side effects to the
variable that occur both inside and outside of body are preserved, even
if continuations are used to jump in and out of body repeatedly. 
</p></blockquote></div>

   <p>Here is a complicated example that shows the interaction between dynamic
binding and continuations:

<pre class="example">     (define (complicated-dynamic-binding)
       (let ((variable 1)
             (inside-continuation))
         (write-line variable)
         (call-with-current-continuation
          (lambda (outside-continuation)
            (fluid-let ((variable 2))
              (write-line variable)
              (set! variable 3)
              (call-with-current-continuation
               (lambda (k)
                 (set! inside-continuation k)
                 (outside-continuation #t)))
              (write-line variable)
              (set! inside-continuation #f))))
         (write-line variable)
         (if inside-continuation
             (begin
               (set! variable 4)
               (inside-continuation #f)))))
</pre>
   <p class="noindent">Evaluating &lsquo;<samp><span class="samp">(complicated-dynamic-binding)</span></samp>&rsquo; writes the following on
the console:

<pre class="example">     1
     2
     1
     3
     4
</pre>
   <p class="noindent">Commentary: the first two values written are the initial binding of
<code>variable</code> and its new binding after the <code>fluid-let</code>'s body is
entered.  Immediately after they are written, <code>variable</code> is set to
&lsquo;<samp><span class="samp">3</span></samp>&rsquo;, and then <code>outside-continuation</code> is invoked, causing us to
exit the body.  At this point, &lsquo;<samp><span class="samp">1</span></samp>&rsquo; is written, demonstrating that
the original value of <code>variable</code> has been restored, because we have
left the body.  Then we set <code>variable</code> to &lsquo;<samp><span class="samp">4</span></samp>&rsquo; and reenter the
body by invoking <code>inside-continuation</code>.  At this point, &lsquo;<samp><span class="samp">3</span></samp>&rsquo; is
written, indicating that the side effect that previously occurred within
the body has been preserved.  Finally, we exit body normally, and write
&lsquo;<samp><span class="samp">4</span></samp>&rsquo;, demonstrating that the side effect that occurred outside of
the body was also preserved.

   </body></html>

