<html lang="en">
<head>
<title>Weak Pairs - MIT/GNU Scheme 9.0.1</title>
<meta http-equiv="Content-Type" content="text/html">
<meta name="description" content="MIT/GNU Scheme 9.0.1">
<meta name="generator" content="makeinfo 4.13">
<link title="Top" rel="start" href="index.html#Top">
<link rel="up" href="Miscellaneous-Datatypes.html#Miscellaneous-Datatypes" title="Miscellaneous Datatypes">
<link rel="prev" href="Streams.html#Streams" title="Streams">
<link href="http://www.gnu.org/software/texinfo/" rel="generator-home" title="Texinfo Homepage">
<!--
This manual documents MIT/GNU Scheme 9.0.1.

Copyright (C) 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993,
    1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004,
    2005, 2006, 2007, 2008, 2009, 2010 Massachusetts Institute of
    Technology

     Permission is granted to copy, distribute and/or modify this
     document under the terms of the GNU Free Documentation License,
     Version 1.2 or any later version published by the Free Software
     Foundation; with no Invariant Sections, with the Front-Cover Texts
     being ``A GNU Manual,'' and with the Back-Cover Texts as in (a)
     below.  A copy of the license is included in the section entitled
     ``GNU Free Documentation License.''

     (a) The FSF's Back-Cover Text is: ``You have freedom to copy and
     modify this GNU Manual, like GNU software.  Copies published by
     the Free Software Foundation raise funds for GNU development.''
   -->
<meta http-equiv="Content-Style-Type" content="text/css">
<style type="text/css"><!--
  pre.display { font-family:inherit }
  pre.format  { font-family:inherit }
  pre.smalldisplay { font-family:inherit; font-size:smaller }
  pre.smallformat  { font-family:inherit; font-size:smaller }
  pre.smallexample { font-size:smaller }
  pre.smalllisp    { font-size:smaller }
  span.sc    { font-variant:small-caps }
  span.roman { font-family:serif; font-weight:normal; } 
  span.sansserif { font-family:sans-serif; font-weight:normal; } 
--></style>
</head>
<body>
<div class="node">
<a name="Weak-Pairs"></a>
<p>
Previous:&nbsp;<a rel="previous" accesskey="p" href="Streams.html#Streams">Streams</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="Miscellaneous-Datatypes.html#Miscellaneous-Datatypes">Miscellaneous Datatypes</a>
<hr>
</div>

<h3 class="section">10.7 Weak Pairs</h3>

<p><a name="index-weak-pair-_0028defn_0029-1568"></a><a name="index-pair_002c-weak-_0028defn_0029-1569"></a><dfn>Weak pairs</dfn> are a mechanism for building data structures that point
at objects without protecting them from garbage collection.  The car of
a weak pair holds its pointer weakly, while the cdr holds its pointer in
the normal way.  If the object in the car of a weak pair is not held
normally by any other data structure, it will be garbage-collected.

   <p><a name="index-pair_003f-1570"></a>Note: weak pairs are <em>not</em> pairs; that is, they do not satisfy the
predicate <code>pair?</code>.

<div class="defun">
&mdash; procedure: <b>weak-pair?</b><var> object<a name="index-weak_002dpair_003f-1571"></a></var><br>
<blockquote><p><a name="index-type-predicate_002c-for-weak-pair-1572"></a>Returns <code>#t</code> if <var>object</var> is a weak pair; otherwise returns
<code>#f</code>. 
</p></blockquote></div>

<div class="defun">
&mdash; procedure: <b>weak-cons</b><var> car cdr<a name="index-weak_002dcons-1573"></a></var><br>
<blockquote><p><a name="index-construction_002c-of-weak-pair-1574"></a>Allocates and returns a new weak pair, with components <var>car</var> and
<var>cdr</var>.  The <var>car</var> component is held weakly. 
</p></blockquote></div>

<div class="defun">
&mdash; procedure: <b>weak-pair/car?</b><var> weak-pair<a name="index-weak_002dpair_002fcar_003f-1575"></a></var><br>
<blockquote><p>This predicate returns <code>#f</code> if the car of <var>weak-pair</var> has been
garbage-collected; otherwise returns <code>#t</code>.  In other words, it is
true if <var>weak-pair</var> has a valid car component. 
</p></blockquote></div>

<div class="defun">
&mdash; procedure: <b>weak-car</b><var> weak-pair<a name="index-weak_002dcar-1576"></a></var><br>
<blockquote><p><a name="index-selection_002c-of-weak-pair-component-1577"></a><a name="index-component-selection_002c-of-weak-pair-1578"></a>Returns the car component of <var>weak-pair</var>.  If the car component has
been garbage-collected, this operation returns <code>#f</code>, but it can
also return <code>#f</code> if that is the value that was stored in the car. 
</p></blockquote></div>

   <p>Normally, <code>weak-pair/car?</code> is used to determine if <code>weak-car</code>
would return a valid value.  An obvious way of doing this would be:

<pre class="example">     (if (weak-pair/car? x)
         (weak-car x)
         ...)
</pre>
   <p class="noindent">However, since a garbage collection could occur between the call to
<code>weak-pair/car?</code> and <code>weak-car</code>, this would not always work
correctly.  Instead, the following should be used, which always works:

<pre class="example">     (or (weak-car x)
         (and (not (weak-pair/car? x))
              ...))
</pre>
   <p>The reason that the latter expression works is that <code>weak-car</code>
returns <code>#f</code> in just two instances: when the car component is
<code>#f</code>, and when the car component has been garbage-collected.  In
the former case, if a garbage collection happens between the two calls,
it won't matter, because <code>#f</code> will never be garbage-collected.  And
in the latter case, it also won't matter, because the car component no
longer exists and cannot be affected by the garbage collector.

<div class="defun">
&mdash; procedure: <b>weak-set-car!</b><var> weak-pair object<a name="index-weak_002dset_002dcar_0021-1579"></a></var><br>
<blockquote><p>Sets the car component of <var>weak-pair</var> to <var>object</var> and returns an
unspecified result. 
</p></blockquote></div>

<div class="defun">
&mdash; procedure: <b>weak-cdr</b><var> weak-pair<a name="index-weak_002dcdr-1580"></a></var><br>
<blockquote><p>Returns the cdr component of <var>weak-cdr</var>. 
</p></blockquote></div>

<div class="defun">
&mdash; procedure: <b>weak-set-cdr!</b><var> weak-pair object<a name="index-weak_002dset_002dcdr_0021-1581"></a></var><br>
<blockquote><p>Sets the cdr component of <var>weak-pair</var> to <var>object</var> and returns an
unspecified result. 
</p></blockquote></div>

   </body></html>

