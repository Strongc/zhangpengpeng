<html lang="en">
<head>
<title>Parser Buffers - MIT/GNU Scheme 9.0.1</title>
<meta http-equiv="Content-Type" content="text/html">
<meta name="description" content="MIT/GNU Scheme 9.0.1">
<meta name="generator" content="makeinfo 4.13">
<link title="Top" rel="start" href="index.html#Top">
<link rel="up" href="Input_002fOutput.html#Input_002fOutput" title="Input/Output">
<link rel="prev" href="Port-Primitives.html#Port-Primitives" title="Port Primitives">
<link rel="next" href="Parser-Language.html#Parser-Language" title="Parser Language">
<link href="http://www.gnu.org/software/texinfo/" rel="generator-home" title="Texinfo Homepage">
<!--
This manual documents MIT/GNU Scheme 9.0.1.

Copyright (C) 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993,
    1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004,
    2005, 2006, 2007, 2008, 2009, 2010 Massachusetts Institute of
    Technology

     Permission is granted to copy, distribute and/or modify this
     document under the terms of the GNU Free Documentation License,
     Version 1.2 or any later version published by the Free Software
     Foundation; with no Invariant Sections, with the Front-Cover Texts
     being ``A GNU Manual,'' and with the Back-Cover Texts as in (a)
     below.  A copy of the license is included in the section entitled
     ``GNU Free Documentation License.''

     (a) The FSF's Back-Cover Text is: ``You have freedom to copy and
     modify this GNU Manual, like GNU software.  Copies published by
     the Free Software Foundation raise funds for GNU development.''
   -->
<meta http-equiv="Content-Style-Type" content="text/css">
<style type="text/css"><!--
  pre.display { font-family:inherit }
  pre.format  { font-family:inherit }
  pre.smalldisplay { font-family:inherit; font-size:smaller }
  pre.smallformat  { font-family:inherit; font-size:smaller }
  pre.smallexample { font-size:smaller }
  pre.smalllisp    { font-size:smaller }
  span.sc    { font-variant:small-caps }
  span.roman { font-family:serif; font-weight:normal; } 
  span.sansserif { font-family:sans-serif; font-weight:normal; } 
--></style>
</head>
<body>
<div class="node">
<a name="Parser-Buffers"></a>
<p>
Next:&nbsp;<a rel="next" accesskey="n" href="Parser-Language.html#Parser-Language">Parser Language</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="Port-Primitives.html#Port-Primitives">Port Primitives</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="Input_002fOutput.html#Input_002fOutput">Input/Output</a>
<hr>
</div>

<h3 class="section">14.10 Parser Buffers</h3>

<p><a name="index-Parser-buffer-2227"></a>The <dfn>parser buffer</dfn> mechanism facilitates construction of parsers
for complex grammars.  It does this by providing an input stream with
unbounded buffering and backtracking.  The amount of buffering is
under program control.  The stream can backtrack to any position in
the buffer.

   <p><a name="index-Parser_002dbuffer-pointer-2228"></a>The mechanism defines two data types: the <dfn>parser buffer</dfn> and the
<dfn>parser-buffer pointer</dfn>.  A parser buffer is like an input port
with buffering and backtracking.  A parser-buffer pointer is a pointer
into the stream of characters provided by a parser buffer.

   <p>Note that all of the procedures defined here consider a parser buffer
to contain a stream of 8-bit characters in the <acronym>ISO-8859-1</acronym>
character set, except for <code>match-utf8-char-in-alphabet</code> which
treats it as a stream of Unicode characters encoded as 8-bit bytes in
the <acronym>UTF-8</acronym> encoding.

   <p>There are several constructors for parser buffers:

<div class="defun">
&mdash; procedure: <b>input-port-&gt;parser-buffer</b><var> port<a name="index-input_002dport_002d_003eparser_002dbuffer-2229"></a></var><br>
<blockquote><p>Returns a parser buffer that buffers characters read from <var>port</var>. 
</p></blockquote></div>

<div class="defun">
&mdash; procedure: <b>substring-&gt;parser-buffer</b><var> string start end<a name="index-substring_002d_003eparser_002dbuffer-2230"></a></var><br>
<blockquote><p>Returns a parser buffer that buffers the characters in the argument
substring.  This is equivalent to creating a string input port and
calling <code>input-port-&gt;parser-buffer</code>, but it runs faster and uses
less memory. 
</p></blockquote></div>

<div class="defun">
&mdash; procedure: <b>string-&gt;parser-buffer</b><var> string<a name="index-string_002d_003eparser_002dbuffer-2231"></a></var><br>
<blockquote><p>Like <code>substring-&gt;parser-buffer</code> but buffers the entire string. 
</p></blockquote></div>

<div class="defun">
&mdash; procedure: <b>source-&gt;parser-buffer</b><var> source<a name="index-source_002d_003eparser_002dbuffer-2232"></a></var><br>
<blockquote><p>Returns a parser buffer that buffers the characters returned by
calling <var>source</var>.  <var>Source</var> is a procedure of three arguments:
a string, a start index, and an end index (in other words, a substring
specifier).  Each time <var>source</var> is called, it writes some
characters in the substring, and returns the number of characters
written.  When there are no more characters available, it returns
zero.  It must not return zero in any other circumstance. 
</p></blockquote></div>

   <p>Parser buffers and parser-buffer pointers may be distinguished from
other objects:

<div class="defun">
&mdash; procedure: <b>parser-buffer?</b><var> object<a name="index-parser_002dbuffer_003f-2233"></a></var><br>
<blockquote><p>Returns <code>#t</code> if <var>object</var> is a parser buffer, otherwise
returns <code>#f</code>. 
</p></blockquote></div>

<div class="defun">
&mdash; procedure: <b>parser-buffer-pointer?</b><var> object<a name="index-parser_002dbuffer_002dpointer_003f-2234"></a></var><br>
<blockquote><p>Returns <code>#t</code> if <var>object</var> is a parser-buffer pointer,
otherwise returns <code>#f</code>. 
</p></blockquote></div>

   <p>Characters can be read from a parser buffer much as they can be read
from an input port.  The parser buffer maintains an internal pointer
indicating its current position in the input stream.  Additionally,
the buffer remembers all characters that were previously read, and can
look at characters arbitrarily far ahead in the stream.  It is this
buffering capability that facilitates complex matching and
backtracking.

<div class="defun">
&mdash; procedure: <b>read-parser-buffer-char</b><var> buffer<a name="index-read_002dparser_002dbuffer_002dchar-2235"></a></var><br>
<blockquote><p>Returns the next character in <var>buffer</var>, advancing the internal
pointer past that character.  If there are no more characters
available, returns <code>#f</code> and leaves the internal pointer
unchanged. 
</p></blockquote></div>

<div class="defun">
&mdash; procedure: <b>peek-parser-buffer-char</b><var> buffer<a name="index-peek_002dparser_002dbuffer_002dchar-2236"></a></var><br>
<blockquote><p>Returns the next character in <var>buffer</var>, or <code>#f</code> if no
characters are available.  Leaves the internal pointer unchanged. 
</p></blockquote></div>

<div class="defun">
&mdash; procedure: <b>parser-buffer-ref</b><var> buffer index<a name="index-parser_002dbuffer_002dref-2237"></a></var><br>
<blockquote><p>Returns a character in <var>buffer</var>.  <var>Index</var> is a non-negative
integer specifying the character to be returned.  If <var>index</var> is
zero, returns the next available character; if it is one, returns the
character after that, and so on.  If <var>index</var> specifies a position
after the last character in <var>buffer</var>, returns <code>#f</code>.  Leaves
the internal pointer unchanged. 
</p></blockquote></div>

   <p>The internal pointer of a parser buffer can be read or written:

<div class="defun">
&mdash; procedure: <b>get-parser-buffer-pointer</b><var> buffer<a name="index-get_002dparser_002dbuffer_002dpointer-2238"></a></var><br>
<blockquote><p>Returns a parser-buffer pointer object corresponding to the internal
pointer of <var>buffer</var>. 
</p></blockquote></div>

<div class="defun">
&mdash; procedure: <b>set-parser-buffer-pointer!</b><var> buffer pointer<a name="index-set_002dparser_002dbuffer_002dpointer_0021-2239"></a></var><br>
<blockquote><p>Sets the internal pointer of <var>buffer</var> to the position specified by
<var>pointer</var>.  <var>Pointer</var> must have been returned from a previous
call of <code>get-parser-buffer-pointer</code> on <var>buffer</var>. 
Additionally, if some of <var>buffer</var>'s characters have been discarded
by <code>discard-parser-buffer-head!</code>, <var>pointer</var> must be outside
the range that was discarded. 
</p></blockquote></div>

<div class="defun">
&mdash; procedure: <b>get-parser-buffer-tail</b><var> buffer pointer<a name="index-get_002dparser_002dbuffer_002dtail-2240"></a></var><br>
<blockquote><p>Returns a newly-allocated string consisting of all of the characters
in <var>buffer</var> that fall between <var>pointer</var> and <var>buffer</var>'s
internal pointer.  <var>Pointer</var> must have been returned from a
previous call of <code>get-parser-buffer-pointer</code> on <var>buffer</var>. 
Additionally, if some of <var>buffer</var>'s characters have been discarded
by <code>discard-parser-buffer-head!</code>, <var>pointer</var> must be outside
the range that was discarded. 
</p></blockquote></div>

<div class="defun">
&mdash; procedure: <b>discard-parser-buffer-head!</b><var> buffer<a name="index-discard_002dparser_002dbuffer_002dhead_0021-2241"></a></var><br>
<blockquote><p>Discards all characters in <var>buffer</var> that have already been read;
in other words, all characters prior to the internal pointer.  After
this operation has completed, it is no longer possible to move the
internal pointer backwards past the current position by calling
<code>set-parser-buffer-pointer!</code>. 
</p></blockquote></div>

   <p>The next rather large set of procedures does conditional matching
against the contents of a parser buffer.  All matching is performed
relative to the buffer's internal pointer, so the first character to
be matched against is the next character that would be returned by
<code>peek-parser-buffer-char</code>.  The returned value is always
<code>#t</code> for a successful match, and <code>#f</code> otherwise.  For
procedures whose names do not end in &lsquo;<samp><span class="samp">-no-advance</span></samp>&rsquo;, a successful
match also moves the internal pointer of the buffer forward to the end
of the matched text; otherwise the internal pointer is unchanged.

<div class="defun">
&mdash; procedure: <b>match-parser-buffer-char</b><var> buffer char<a name="index-match_002dparser_002dbuffer_002dchar-2242"></a></var><br>
&mdash; procedure: <b>match-parser-buffer-char-ci</b><var> buffer char<a name="index-match_002dparser_002dbuffer_002dchar_002dci-2243"></a></var><br>
&mdash; procedure: <b>match-parser-buffer-not-char</b><var> buffer char<a name="index-match_002dparser_002dbuffer_002dnot_002dchar-2244"></a></var><br>
&mdash; procedure: <b>match-parser-buffer-not-char-ci</b><var> buffer char<a name="index-match_002dparser_002dbuffer_002dnot_002dchar_002dci-2245"></a></var><br>
&mdash; procedure: <b>match-parser-buffer-char-no-advance</b><var> buffer char<a name="index-match_002dparser_002dbuffer_002dchar_002dno_002dadvance-2246"></a></var><br>
&mdash; procedure: <b>match-parser-buffer-char-ci-no-advance</b><var> buffer char<a name="index-match_002dparser_002dbuffer_002dchar_002dci_002dno_002dadvance-2247"></a></var><br>
&mdash; procedure: <b>match-parser-buffer-not-char-no-advance</b><var> buffer char<a name="index-match_002dparser_002dbuffer_002dnot_002dchar_002dno_002dadvance-2248"></a></var><br>
&mdash; procedure: <b>match-parser-buffer-not-char-ci-no-advance</b><var> buffer char<a name="index-match_002dparser_002dbuffer_002dnot_002dchar_002dci_002dno_002dadvance-2249"></a></var><br>
<blockquote><p>Each of these procedures compares a single character in <var>buffer</var>
to <var>char</var>.  The basic comparison <code>match-parser-buffer-char</code>
compares the character to <var>char</var> using <code>char=?</code>.  The
procedures whose names contain the &lsquo;<samp><span class="samp">-ci</span></samp>&rsquo; modifier do
case-insensitive comparison (i.e. they use <code>char-ci=?</code>).  The
procedures whose names contain the &lsquo;<samp><span class="samp">not-</span></samp>&rsquo; modifier are successful
if the character <em>doesn't</em> match <var>char</var>. 
</p></blockquote></div>

<div class="defun">
&mdash; procedure: <b>match-parser-buffer-char-in-set</b><var> buffer char-set<a name="index-match_002dparser_002dbuffer_002dchar_002din_002dset-2250"></a></var><br>
&mdash; procedure: <b>match-parser-buffer-char-in-set-no-advance</b><var> buffer char-set<a name="index-match_002dparser_002dbuffer_002dchar_002din_002dset_002dno_002dadvance-2251"></a></var><br>
<blockquote><p>These procedures compare the next character in <var>buffer</var> against
<var>char-set</var> using <code>char-set-member?</code>. 
</p></blockquote></div>

<div class="defun">
&mdash; procedure: <b>match-parser-buffer-string</b><var> buffer string<a name="index-match_002dparser_002dbuffer_002dstring-2252"></a></var><br>
&mdash; procedure: <b>match-parser-buffer-string-ci</b><var> buffer string<a name="index-match_002dparser_002dbuffer_002dstring_002dci-2253"></a></var><br>
&mdash; procedure: <b>match-parser-buffer-string-no-advance</b><var> buffer string<a name="index-match_002dparser_002dbuffer_002dstring_002dno_002dadvance-2254"></a></var><br>
&mdash; procedure: <b>match-parser-buffer-string-ci-no-advance</b><var> buffer string<a name="index-match_002dparser_002dbuffer_002dstring_002dci_002dno_002dadvance-2255"></a></var><br>
<blockquote><p>These procedures match <var>string</var> against <var>buffer</var>'s contents. 
The &lsquo;<samp><span class="samp">-ci</span></samp>&rsquo; procedures do case-insensitive matching. 
</p></blockquote></div>

<div class="defun">
&mdash; procedure: <b>match-parser-buffer-substring</b><var> buffer string start end<a name="index-match_002dparser_002dbuffer_002dsubstring-2256"></a></var><br>
&mdash; procedure: <b>match-parser-buffer-substring-ci</b><var> buffer string start end<a name="index-match_002dparser_002dbuffer_002dsubstring_002dci-2257"></a></var><br>
&mdash; procedure: <b>match-parser-buffer-substring-no-advance</b><var> buffer string start end<a name="index-match_002dparser_002dbuffer_002dsubstring_002dno_002dadvance-2258"></a></var><br>
&mdash; procedure: <b>match-parser-buffer-substring-ci-no-advance</b><var> buffer string start end<a name="index-match_002dparser_002dbuffer_002dsubstring_002dci_002dno_002dadvance-2259"></a></var><br>
<blockquote><p>These procedures match the specified substring against <var>buffer</var>'s
contents.  The &lsquo;<samp><span class="samp">-ci</span></samp>&rsquo; procedures do case-insensitive matching. 
</p></blockquote></div>

<div class="defun">
&mdash; procedure: <b>match-utf8-char-in-alphabet</b><var> buffer alphabet<a name="index-match_002dutf8_002dchar_002din_002dalphabet-2260"></a></var><br>
<blockquote><p>This procedure treats <var>buffer</var>'s contents as <acronym>UTF-8</acronym>
encoded Unicode characters and matches the next such character against
<var>alphabet</var>, which must be a Unicode alphabet (see <a href="Unicode.html#Unicode">Unicode</a>). 
<acronym>UTF-8</acronym> represents characters with 1 to 6 bytes, so a
successful match can move the internal pointer forward by as many as 6
bytes. 
</p></blockquote></div>

   <p>The remaining procedures provide information that can be used to
identify locations in a parser buffer's stream.

<div class="defun">
&mdash; procedure: <b>parser-buffer-position-string</b><var> pointer<a name="index-parser_002dbuffer_002dposition_002dstring-2261"></a></var><br>
<blockquote><p>Returns a string describing the location of <var>pointer</var> in terms of
its character and line indexes.  This resulting string is meant to be
presented to an end user in order to direct their attention to a
feature in the input stream.  In this string, the indexes are
presented as one-based numbers.

        <p><var>Pointer</var> may alternatively be a parser buffer, in which case it
is equivalent to having specified the buffer's internal pointer. 
</p></blockquote></div>

<div class="defun">
&mdash; procedure: <b>parser-buffer-pointer-index</b><var> pointer<a name="index-parser_002dbuffer_002dpointer_002dindex-2262"></a></var><br>
&mdash; procedure: <b>parser-buffer-pointer-line</b><var> pointer<a name="index-parser_002dbuffer_002dpointer_002dline-2263"></a></var><br>
<blockquote><p>Returns the character or line index, respectively, of <var>pointer</var>. 
Both indexes are zero-based. 
</p></blockquote></div>

   </body></html>

