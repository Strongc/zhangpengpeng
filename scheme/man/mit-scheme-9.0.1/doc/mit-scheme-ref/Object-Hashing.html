<html lang="en">
<head>
<title>Object Hashing - MIT/GNU Scheme 9.0.1</title>
<meta http-equiv="Content-Type" content="text/html">
<meta name="description" content="MIT/GNU Scheme 9.0.1">
<meta name="generator" content="makeinfo 4.13">
<link title="Top" rel="start" href="index.html#Top">
<link rel="up" href="Associations.html#Associations" title="Associations">
<link rel="prev" href="Hash-Tables.html#Hash-Tables" title="Hash Tables">
<link rel="next" href="Red_002dBlack-Trees.html#Red_002dBlack-Trees" title="Red-Black Trees">
<link href="http://www.gnu.org/software/texinfo/" rel="generator-home" title="Texinfo Homepage">
<!--
This manual documents MIT/GNU Scheme 9.0.1.

Copyright (C) 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993,
    1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004,
    2005, 2006, 2007, 2008, 2009, 2010 Massachusetts Institute of
    Technology

     Permission is granted to copy, distribute and/or modify this
     document under the terms of the GNU Free Documentation License,
     Version 1.2 or any later version published by the Free Software
     Foundation; with no Invariant Sections, with the Front-Cover Texts
     being ``A GNU Manual,'' and with the Back-Cover Texts as in (a)
     below.  A copy of the license is included in the section entitled
     ``GNU Free Documentation License.''

     (a) The FSF's Back-Cover Text is: ``You have freedom to copy and
     modify this GNU Manual, like GNU software.  Copies published by
     the Free Software Foundation raise funds for GNU development.''
   -->
<meta http-equiv="Content-Style-Type" content="text/css">
<style type="text/css"><!--
  pre.display { font-family:inherit }
  pre.format  { font-family:inherit }
  pre.smalldisplay { font-family:inherit; font-size:smaller }
  pre.smallformat  { font-family:inherit; font-size:smaller }
  pre.smallexample { font-size:smaller }
  pre.smalllisp    { font-size:smaller }
  span.sc    { font-variant:small-caps }
  span.roman { font-family:serif; font-weight:normal; } 
  span.sansserif { font-family:sans-serif; font-weight:normal; } 
--></style>
</head>
<body>
<div class="node">
<a name="Object-Hashing"></a>
<p>
Next:&nbsp;<a rel="next" accesskey="n" href="Red_002dBlack-Trees.html#Red_002dBlack-Trees">Red-Black Trees</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="Hash-Tables.html#Hash-Tables">Hash Tables</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="Associations.html#Associations">Associations</a>
<hr>
</div>

<h3 class="section">11.5 Object Hashing</h3>

<p><a name="index-object-hashing-1703"></a><a name="index-hashing_002c-of-object-1704"></a>The MIT/GNU Scheme object-hashing facility provides a mechanism for
generating a unique hash number for an arbitrary object.  This hash
number, unlike an object's address, is unchanged by garbage collection. 
The object-hashing facility is useful in conjunction with hash tables,
but it may be used for other things as well.  In particular, it is used
in the generation of the written representation for many objects
(see <a href="Custom-Output.html#Custom-Output">Custom Output</a>).

   <p>All of these procedures accept an optional argument called <var>table</var>;
this table contains the object-integer associations.  If given, this
argument must be an object-hash table as constructed by
<code>hash-table/make</code> (see below).  If not given, a default table is
used.

<div class="defun">
&mdash; procedure: <b>hash</b><var> object </var>[<var>table</var>]<var><a name="index-hash-1705"></a></var><br>
<blockquote><p><a name="index-eq_003f-1706"></a><code>hash</code> associates an exact non-negative integer with <var>object</var>
and returns that integer.  If <code>hash</code> was previously called with
<var>object</var> as its argument, the integer returned is the same as was
returned by the previous call.  <code>hash</code> guarantees that distinct
objects (in the sense of <code>eq?</code>) are associated with distinct
integers. 
</p></blockquote></div>

<div class="defun">
&mdash; procedure: <b>unhash</b><var> k </var>[<var>table</var>]<var><a name="index-unhash-1707"></a></var><br>
<blockquote><p><code>unhash</code> takes an exact non-negative integer <var>k</var> and returns
the object associated with that integer.  If there is no object
associated with <var>k</var>, or if the object previously associated with
<var>k</var> has been reclaimed by the garbage collector, an error of type
<code>condition-type:bad-range-argument</code> is signalled.  In other words,
if <code>hash</code> previously returned <var>k</var> for some object, and that
object has not been reclaimed, it is the value of the call to
<code>unhash</code>. 
<a name="index-condition_002dtype_003abad_002drange_002dargument-1708"></a></p></blockquote></div>

   <p>An object that is passed to <code>hash</code> as an argument is not protected
from being reclaimed by the garbage collector.  If all other references
to that object are eliminated, the object will be reclaimed. 
Subsequently calling <code>unhash</code> with the hash number of the (now
reclaimed) object will signal an error.

<pre class="example">     (define x (cons 0 0))           &rArr;  <span class="roman">unspecified</span>
     (hash x)                        &rArr;  77
     (eqv? (hash x) (hash x))        &rArr;  #t
     (define x 0)                    &rArr;  <span class="roman">unspecified</span>
     (gc-flip)                       <span class="roman">;force a garbage collection</span>
     (unhash 77)                     error--&gt;
</pre>
   <div class="defun">
&mdash; procedure: <b>object-hashed?</b><var> object </var>[<var>table</var>]<var><a name="index-object_002dhashed_003f-1709"></a></var><br>
<blockquote><p>This predicate is true if <var>object</var> has an associated hash number. 
Otherwise it is false. 
</p></blockquote></div>

<div class="defun">
&mdash; procedure: <b>valid-hash-number?</b><var> k </var>[<var>table</var>]<var><a name="index-valid_002dhash_002dnumber_003f-1710"></a></var><br>
<blockquote><p>This predicate is true if <var>k</var> is the hash number associated with
some object.  Otherwise it is false. 
</p></blockquote></div>

   <p>The following two procedures provide a lower-level interface to the
object-hashing mechanism.

<div class="defun">
&mdash; procedure: <b>object-hash</b><var> object </var>[<var>table </var>[<var>insert?</var>]]<var><a name="index-object_002dhash-1711"></a></var><br>
<blockquote><p><a name="index-eq_003f-1712"></a><code>object-hash</code> is like <code>hash</code>, except that it accepts an
additional optional argument, <var>insert?</var>.  If <var>insert?</var> is
supplied and is <code>#f</code>, <code>object-hash</code> will return an integer for
<var>object</var> only if there is already an association in the table;
otherwise, it will return <code>#f</code>.  If <var>insert?</var> is not supplied,
or is not <code>#f</code>, <code>object-hash</code> always returns an integer,
creating an association in the table if necessary.

        <p><code>object-hash</code> additionally treats <code>#f</code> differently than does
<code>hash</code>.  Calling <code>object-hash</code> with <code>#f</code> as its argument
will return an integer that, when passed to <code>unhash</code>, will signal
an error rather than returning <code>#f</code>.  Likewise,
<code>valid-hash-number?</code> will return <code>#f</code> for this integer. 
</p></blockquote></div>

<div class="defun">
&mdash; procedure: <b>object-unhash</b><var> k </var>[<var>table</var>]<var><a name="index-object_002dunhash-1713"></a></var><br>
<blockquote><p><code>object-unhash</code> is like <code>unhash</code>, except that when <var>k</var> is
not associated with any object or was previously associated with an
object that has been reclaimed, <code>object-unhash</code> returns <code>#f</code>. 
This means that there is an ambiguity in the value returned by
<code>object-unhash</code>: if <code>#f</code> is returned, there is no way to
tell if <var>k</var> is associated with <code>#f</code> or is not associated with
any object at all. 
</p></blockquote></div>

   <p>Finally, this procedure makes new object-hash tables:

<div class="defun">
&mdash; procedure: <b>hash-table/make</b><var><a name="index-hash_002dtable_002fmake-1714"></a></var><br>
<blockquote><p>This procedure creates and returns a new, empty object-hash table that
is suitable for use as the optional <var>table</var> argument to the above
procedures.  The returned table contains no associations. 
</p></blockquote></div>

   </body></html>

