<html lang="en">
<head>
<title>Reduction of Operators - MIT/GNU Scheme 9.0</title>
<meta http-equiv="Content-Type" content="text/html">
<meta name="description" content="MIT/GNU Scheme 9.0">
<meta name="generator" content="makeinfo 4.13">
<link title="Top" rel="start" href="index.html#Top">
<link rel="up" href="Declarations.html#Declarations" title="Declarations">
<link rel="prev" href="Replacement-of-Operators.html#Replacement-of-Operators" title="Replacement of Operators">
<link href="http://www.gnu.org/software/texinfo/" rel="generator-home" title="Texinfo Homepage">
<!--
This manual documents the use of MIT/GNU Scheme 9.0.

Copyright (C) 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993,
    1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004,
    2005, 2006, 2007, 2008, 2009, 2010 Massachusetts Institute of
    Technology

     Permission is granted to copy, distribute and/or modify this
     document under the terms of the GNU Free Documentation License,
     Version 1.2 or any later version published by the Free Software
     Foundation; with no Invariant Sections, with the Front-Cover Texts
     being ``A GNU Manual,'' and with the Back-Cover Texts as in (a)
     below.  A copy of the license is included in the section entitled
     ``GNU Free Documentation License.''

     (a) The FSF's Back-Cover Text is: ``You have freedom to copy and
     modify this GNU Manual, like GNU software.  Copies published by
     the Free Software Foundation raise funds for GNU development.''
   -->
<meta http-equiv="Content-Style-Type" content="text/css">
<style type="text/css"><!--
  pre.display { font-family:inherit }
  pre.format  { font-family:inherit }
  pre.smalldisplay { font-family:inherit; font-size:smaller }
  pre.smallformat  { font-family:inherit; font-size:smaller }
  pre.smallexample { font-size:smaller }
  pre.smalllisp    { font-size:smaller }
  span.sc    { font-variant:small-caps }
  span.roman { font-family:serif; font-weight:normal; } 
  span.sansserif { font-family:sans-serif; font-weight:normal; } 
--></style>
</head>
<body>
<div class="node">
<a name="Reduction-of-Operators"></a>
<p>
Previous:&nbsp;<a rel="previous" accesskey="p" href="Replacement-of-Operators.html#Replacement-of-Operators">Replacement of Operators</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="Declarations.html#Declarations">Declarations</a>
<hr>
</div>

<h4 class="subsection">4.2.4 Operator Reduction</h4>

<p><a name="index-reduce_002doperator-151"></a>The <code>reduce-operator</code> declaration is provided to inform the
compiler that certain names are n-ary versions of binary operators. 
Here are some examples:

<p class="noindent">Declaration:

<pre class="example">     (declare (reduce-operator (cons* cons)))
</pre>
   <p class="noindent">Replacements:

<pre class="example">     (cons* <var>x</var> <var>y</var> <var>z</var> <var>w</var>) ==&gt; (cons <var>x</var> (cons <var>y</var> (cons <var>z</var> <var>w</var>))),
     (cons* <var>x</var> <var>y</var>) ==&gt; (cons <var>x</var> <var>y</var>)
     (cons* <var>x</var>) ==&gt; <var>x</var>
     (cons*) error--&gt; too few arguments
</pre>
   <p class="noindent">Declaration:

<pre class="example">     (declare (reduce-operator (list cons (null-value '() any))))
</pre>
   <p class="noindent">Replacements:

<pre class="example">     (list <var>x</var> <var>y</var> <var>z</var> <var>w</var>) ==&gt; (cons <var>x</var> (cons <var>y</var> (cons <var>z</var> (cons <var>w</var> '()))))
     (list <var>x</var> <var>y</var>) ==&gt; (cons <var>x</var> (cons <var>y</var> '()))
     (list <var>x</var>) ==&gt; (cons <var>x</var> '())
     (list) ==&gt; '()
</pre>
   <p class="noindent">Declaration:

<pre class="example">     (declare (reduce-operator (- %- (null-value 0 single) (group left))))
</pre>
   <p class="noindent">Replacements:

<pre class="example">     (- <var>x</var> <var>y</var> <var>z</var> <var>w</var>) ==&gt; (%- (%- (%- <var>x</var> <var>y</var>) <var>z</var>) <var>w</var>)
     (- <var>x</var> <var>y</var>) ==&gt; (%- <var>x</var> <var>y</var>)
     (- <var>x</var>) ==&gt; (%- 0 <var>x</var>)
     (-) ==&gt; 0
</pre>
   <p class="noindent">Declaration:

<pre class="example">     (declare (reduce-operator (+ %+ (null-value 0 none) (group right))))
</pre>
   <p class="noindent">Replacements:

<pre class="example">     (+ <var>x</var> <var>y</var> <var>z</var> <var>w</var>) ==&gt; (%+ <var>x</var> (%+ <var>y</var> (%+ <var>z</var> <var>w</var>)))
     (+ <var>x</var> <var>y</var>) ==&gt; (%+ <var>x</var> <var>y</var>)
     (+ <var>x</var>) ==&gt; <var>x</var>
     (+) ==&gt; 0
</pre>
   <p>Note: This declaration does not cause an appropriate definition of
<code>%+</code> (in the last example) to appear in your code.  It merely
informs the compiler that certain optimizations can be performed on
calls to <code>+</code> by replacing them with calls to <code>%+</code>.  You should
provide a definition of <code>%+</code> as well, although it is not required.

<p class="noindent">Declaration:

<pre class="example">     (declare (reduce-operator (apply (primitive cons)
                                      (group right)
                                      (wrapper (global apply) 1))))
</pre>
   <p class="noindent">Replacements:

<pre class="example">     (apply <var>f</var> <var>x</var> <var>y</var> <var>z</var> <var>w</var>)
        ==&gt; ((access apply #f) <var>f</var> (cons <var>x</var> (cons <var>y</var> (cons <var>z</var> <var>w</var>))))
     (apply <var>f</var> <var>x</var> <var>y</var>)
        ==&gt; ((access apply #f) <var>f</var> (cons <var>x</var> <var>y</var>))
     (apply <var>f</var> <var>x</var>) ==&gt; (apply <var>f</var> <var>x</var>)
     (apply <var>f</var>) ==&gt; (apply <var>f</var>)
     (apply) ==&gt; (apply)
</pre>
   <div class="defun">
&mdash; declaration: <b>reduce-operator</b><var> name <small class="dots">...</small><a name="index-reduce_002doperator-152"></a></var><br>
<blockquote><p>The general format of the declaration is (brackets denote optional
elements):

     <pre class="example">          (reduce-operator
            (<var>name</var>
              <var>binop</var>
              <span class="roman">[</span>(group <var>ordering</var>)<span class="roman">]</span>
              <span class="roman">[</span>(null-value <var>value</var> <var>null-option</var>)<span class="roman">]</span>
              <span class="roman">[</span>(singleton <var>unop</var>)<span class="roman">]</span>
              <span class="roman">[</span>(wrapper <var>wrap</var> <span class="roman">[</span>n<span class="roman">]</span>)<span class="roman">]</span>
              <span class="roman">[</span>(maximum <var>m</var>)<span class="roman">]</span>
            ))
</pre>
        <p class="noindent">where

          <ul>
<li><var>n</var> and <var>m</var> are non-negative integers.

          <li><var>name</var> is a symbol.

          <li><var>binop</var>, <var>value</var>, <var>unop</var>, and <var>wrap</var> are simple
expressions in one of these forms:

               <dl>
<dt><code>'</code><var>constant</var><dd>A constant.

               <br><dt><var>variable</var><dd>A variable.

               <br><dt><code>(primitive </code><var>primitive-name</var> <span class="roman">[</span><var>arity</var><span class="roman">]</span><code>)</code><dd>The primitive procedure named <var>primitive-name</var>.  The optional
element <var>arity</var> specifies the number of arguments that the primitive
accepts.

               <br><dt><code>(global </code><var>var</var><code>)</code><dd>A global variable. 
</dl>

          <li><var>null-option</var> is either <code>always</code>, <code>any</code>, <code>one</code>,
<code>single</code>, <code>none</code>, or <code>empty</code>.

          <li><var>ordering</var> is either <code>left</code>, <code>right</code>, or
<code>associative</code>. 
</ul>

     <p class="noindent">The meaning of these fields is:

          <ul>
<li><var>name</var> is the name of the n-ary operation to be reduced.

          <li><var>binop</var> is the binary operation into which the n-ary operation is to
be reduced.

          <li>The <code>group</code> option specifies whether <var>name</var> associates to the
right or left.

          <li>The <code>null-value</code> option specifies a value to use in the following
cases:

               <dl>
<dt><code>none</code><dt><code>empty</code><dd>When no arguments are supplied to <var>name</var>, <var>value</var> is returned.

               <br><dt><code>one</code><dt><code>single</code><dd>When a single argument is provided to <var>name</var>, <var>value</var> becomes
the second argument to <var>binop</var>.

               <br><dt><code>any</code><dt><code>always</code><dd><var>binop</var> is used on the &ldquo;last&rdquo; argument, and <var>value</var> provides
the remaining argument to <var>binop</var>. 
</dl>

          <p>In the above options, when <var>value</var> is supplied to <var>binop</var>, it is
supplied on the left if grouping to the left, otherwise it is supplied
on the right.

          <li>The <code>singleton</code> option specifies a function, <var>unop</var>, to be
invoked on the single argument given.  This option supersedes the
<code>null-value</code> option, which can only take the value <code>none</code>.

          <li>The <code>wrapper</code> option specifies a function, <var>wrap</var>, to be
invoked on the result of the outermost call to <var>binop</var> after the
expansion.  If <var>n</var> is provided it must be a non-negative integer
indicating a number of arguments that are transferred verbatim from the
original call to the wrapper.  They are passed to the left of the
reduction.

          <li>The maximum option specifies that calls with more than <var>m</var> arguments
should not be reduced. 
</ul>
        </p></blockquote></div>

   </body></html>

